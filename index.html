<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prospects proches</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6558ff">
<style>
  body{margin:0;background:#0f141b;color:#eaf2ff;font:16px/1.4 system-ui}
  .wrap{max-width:880px;margin:32px auto;padding:0 16px}
  .title{font-weight:700;font-size:22px;margin:0 0 6px}
  .city{color:#9db2ce;margin:0 0 18px}
  .card{background:#152033;border-radius:16px;padding:14px 14px 18px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  .row{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap}
  .btn{background:#1b2844;color:#eaf2ff;border:1px solid #223456;border-radius:12px;padding:12px 14px;cursor:pointer}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn-primary{background:#6558ff;border-color:#7a6dff;font-weight:600;flex:1}
  select,input[type="checkbox"]{accent-color:#6558ff}
  select{padding:10px;border-radius:12px;border:1px solid #24344f;background:#10203a;color:#eaf2ff;flex:1}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 6px}
  .chip{background:#1c2a43;border:1px solid #284068;color:#cfe1ff;border-radius:999px;padding:8px 12px;cursor:pointer}
  .chip.active{background:#6558ff;border-color:#7a6dff;color:#fff}
  .results{margin-top:14px}
  .item{background:#0f192d;border:1px solid #203050;border-radius:12px;padding:12px;margin-top:10px}
  .item a{color:#cfe1ff;text-decoration:none}
  .badge{font-size:12px;opacity:.85}
  .meta{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0}
  .row-slim{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .legend{margin-top:14px;font-size:14px;color:#9db2ce}
  .spinner{display:inline-block;width:16px;height:16px;border-radius:50%;border:2px solid rgba(255,255,255,.25);border-top-color:#fff;animation:spin .8s linear infinite;margin-right:8px;vertical-align:-3px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .text{flex:1;min-width:220px;padding:10px 12px;border-radius:12px;border:1px solid #24344f;background:#10203a;color:#eaf2ff}
</style>
</head>
<body>
<div class="wrap">
  <h1 class="title">Prospects proches</h1>
  <div class="city">Ville : <span id="city">‚Äî</span></div>

  <div class="card">
    <!-- ... tes filtres et boutons inchang√©s ... -->
    <div id="results" class="results"></div>
    <div class="legend">
      üü¢ = Ouvert &nbsp; | &nbsp; üî¥ = Ferm√© &nbsp; | &nbsp; ‚ö™ = Horaires non renseign√©s
    </div>
  </div>
</div>

<script>
const WORKER_URL = "https://restless-heart-0d76.thiery-dimitri-pro.workers.dev";

const els = { /* ... inchang√© ... */ };
let state = {lat:null, lon:null, city:null, results:[]};

// ---------- Helpers ----------
function setSearching(on){ /* ... inchang√© ... */ }
function toast(msg){ /* ... inchang√© ... */ }
function distKm(a,b,c,d){ /* ... inchang√© ... */ }
function savePrefs(){ /* ... inchang√© ... */ }
function loadPrefs(){ /* ... inchang√© ... */ }
['change','click'].forEach(ev=>{ /* ... inchang√© ... */ });

// ---------- Chips / Ajout mot-cl√© / G√©oloc / Recherche ... inchang√©s ----------

// ---------- Maps Patch ----------
function isAndroid(){ return /Android/i.test(navigator.userAgent); }
function isStandalone(){
  return (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches)
         || window.navigator.standalone === true;
}
function openMaps({name, addr, lat, lon, place_id}){
  const label = name || addr || '';
  if(isAndroid() && isStandalone() && lat && lon){
    const geo = `geo:${lat},${lon}?q=${encodeURIComponent(label)}@${lat},${lon}`;
    window.location.href = geo;
    return;
  }
  let url = '';
  if(place_id){
    url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(label)}&query_place_id=${encodeURIComponent(place_id)}`;
  }else if(lat && lon){
    url = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
  }else{
    url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(label)}`;
  }
  window.open(url,'_blank','noopener,noreferrer');
}

// ---------- R√©sultats (modifi√© seulement le bouton Maps) ----------
els.btnSearch.addEventListener('click', async()=>{
  // ... ton code de recherche identique ...
  els.results.innerHTML = rows.map((p,i)=>`
    <div class="item">
      <div><strong>${p.name}</strong></div>
      <div class="meta">
        <span>${p.status==="open"?"üü¢ Ouvert":p.status==="closed"?"üî¥ Ferm√©":"‚ö™ Horaires non renseign√©s"}</span>
        <span class="badge">${p.kw} ¬∑ ${p.dist.toFixed(1)} km</span>
        <span class="badge">${p.addr}</span>
      </div>
      <div class="row-slim">
        <button class="btn" onclick='openMaps(${JSON.stringify(p)})'>‚û°Ô∏è Maps</button>
        <button class="btn" onclick="showDetails('${p.place_id}','det-${i}')">üìû Coordonn√©es</button>
      </div>
      <div class="badge" id="det-${i}" style="margin-top:6px;display:none"></div>
    </div>
  `).join("");
});

// ---------- D√©tails / Export / Reset / SW registration ... inchang√©s ----------
</script>
</body>
</html>
